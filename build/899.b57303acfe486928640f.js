(self.webpackChunkclient=self.webpackChunkclient||[]).push([[899],{130:(e,n,t)=>{"use strict";var r=t(817);e.exports=function(e){var n,c={stun:(e||{}).stun||t(439),turn:(e||{}).turn||t(56)},u=(e||{}).stunCount||2,o=(e||{}).turnCount||0;function i(e,n){for(var t,u=[],o=[].concat(c[e]);o.length&&u.length<n;)t=Math.random()*o.length|0,u=u.concat(o.splice(t,1));return u.map((function(n){return"string"==typeof n||n instanceof String?r(e+":"+n):n}))}return n=[].concat(i("stun",u)),o&&(n=n.concat(i("turn",o))),n}},817:e=>{var n=["stun:","turn:"];e.exports=function(e){var t,r,c=(e||{}).url||e,u={};return"string"==typeof c||c instanceof String?(c=c.trim(),(t=n[n.indexOf(c.slice(0,5))])?(r=(c=c.slice(5)).split("@"),u.username=e.username,u.credential=e.credential,r.length>1&&(c=r[1],r=r[0].split(":"),u.username=r[0],u.credential=(e||{}).credential||r[1]||""),u.url=t+c,u.urls=[u.url],u):e):e}},242:(e,n,t)=>{"use strict";t.d(n,{k:()=>r});var r={JOIN:"join",LEAVE:"leave",SHARE_ROOMS:"share-rooms",ADD_PEER:"add-peer",REMOVE_PEER:"remove-peer",RELAY_SDP:"relay-sdp",RELAY_ICE:"relay-ice",ICE_CANDIDATE:"ice-candidate",SESSION_DESCRIPTION:"session-description"}},172:(e,n,t)=>{"use strict";t.d(n,{s:()=>r});var r=(0,t(80).io)("".concat("https://videochat-server-n85i.onrender.com"),{"force new connection":!0,reconnectionAttempts:1e15,timeout:1e4,transports:["websocket"]})},899:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>m});var r=t(848),c=t(942),u=t.n(c);const o={};var i=t(767),s=t(540),a=t(172),l=t(242),f=t(130),d=t.n(f),p=function(e,n,t,r){return new(t||(t=Promise))((function(c,u){function o(e){try{s(r.next(e))}catch(e){u(e)}}function i(e){try{s(r.throw(e))}catch(e){u(e)}}function s(e){var n;e.done?c(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,i)}s((r=r.apply(e,n||[])).next())}))},h=function(e,n){var t,r,c,u,o={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u&&(u=0,i[0]&&(o=0)),o;)try{if(t=1,r&&(c=2&i[0]?r.return:i[0]?r.throw||((c=r.return)&&c.call(r),0):r.next)&&!(c=c.call(r,i[1])).done)return c;switch(r=0,c&&(i=[2&i[0],c.value]),i[0]){case 0:case 1:c=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((c=(c=o.trys).length>0&&c[c.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!c||i[1]>c[0]&&i[1]<c[3])){o.label=i[1];break}if(6===i[0]&&o.label<c[1]){o.label=c[1],c=i;break}if(c&&o.label<c[2]){o.label=c[2],o.ops.push(i);break}c[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(e,o)}catch(e){i=[6,e],r=0}finally{t=c=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},v=function(e,n,t){if(t||2===arguments.length)for(var r,c=0,u=n.length;c<u;c++)!r&&c in n||(r||(r=Array.prototype.slice.call(n,0,c)),r[c]=n[c]);return e.concat(r||Array.prototype.slice.call(n))},E="LOCAL_VIDEO",g=function(e){e.className;var n=function(e){var n,t=function(e){var n=(0,s.useState)([]),t=n[0],r=n[1],c=(0,s.useRef)(null),u=(0,s.useCallback)((function(e,n){c.current=n,r((function(n){return"function"==typeof e?e(n):e}))}),[]);return(0,s.useEffect)((function(){c.current&&(c.current(t),c.current=null)}),[t]),[t,u]}(),r=t[0],c=t[1],u=(0,s.useCallback)((function(e,n){c((function(n){return n.includes(e)?n:v(v([],n,!0),[e],!1)}),n)}),[r,c]),o=(0,s.useRef)({}),i=(0,s.useRef)(null),f=(0,s.useRef)(((n={})[E]=null,n));return(0,s.useEffect)((function(){return a.s.on(l.k.ADD_PEER,(function(e){return p(this,arguments,void 0,(function(e){var n,t,r=e.peerID,c=e.createOffer;return h(this,(function(e){switch(e.label){case 0:return r in o.current?[2,console.warn("Already connected to peer ".concat(r))]:(o.current[r]=new RTCPeerConnection({iceServers:d()()}),o.current[r].onicecandidate=function(e){e.candidate&&a.s.emit(l.k.RELAY_ICE,{peerID:r,iceCandidate:e.candidate})},n=0,o.current[r].ontrack=function(e){var t=e.streams[0];2==++n&&(n=0,u(r,(function(){if(f.current[r])f.current[r].srcObject=t;else var e=!1,n=setInterval((function(){f.current[r]&&(f.current[r].srcObject=t,e=!0),e&&clearInterval(n)}),1e3)})))},i.current.getTracks().forEach((function(e){o.current[r].addTrack(e,i.current)})),c?[4,o.current[r].createOffer()]:[3,3]);case 1:return t=e.sent(),[4,o.current[r].setLocalDescription(t)];case 2:e.sent(),a.s.emit(l.k.RELAY_SDP,{peerID:r,sessionDescription:t}),e.label=3;case 3:return[2]}}))}))})),function(){a.s.off(l.k.ADD_PEER)}}),[]),(0,s.useEffect)((function(){return a.s.on(l.k.SESSION_DESCRIPTION,(function(e){return p(this,arguments,void 0,(function(e){var n,t,r=e.peerID,c=e.sessionDescription;return h(this,(function(e){switch(e.label){case 0:return[4,null===(t=o.current[r])||void 0===t?void 0:t.setRemoteDescription(new RTCSessionDescription(c))];case 1:return e.sent(),"offer"!==c.type?[3,4]:[4,o.current[r].createAnswer()];case 2:return n=e.sent(),[4,o.current[r].setLocalDescription(n)];case 3:e.sent(),a.s.emit(l.k.RELAY_SDP,{peerID:r,sessionDescription:n}),e.label=4;case 4:return[2]}}))}))})),function(){a.s.off(l.k.SESSION_DESCRIPTION)}}),[]),(0,s.useEffect)((function(){return a.s.on(l.k.ICE_CANDIDATE,(function(e){var n,t=e.peerID,r=e.iceCandidate;null===(n=o.current[t])||void 0===n||n.addIceCandidate(new RTCIceCandidate(r))})),function(){a.s.off(l.k.ICE_CANDIDATE)}}),[]),(0,s.useEffect)((function(){return a.s.on(l.k.REMOVE_PEER,(function(e){var n=e.peerID;o.current[n]&&o.current[n].close(),delete o.current[n],delete f.current[n],c((function(e){return e.filter((function(e){return e!==n}))}))})),function(){a.s.off(l.k.REMOVE_PEER)}}),[]),(0,s.useEffect)((function(){return function(){return p(this,void 0,void 0,(function(){var e,n;return h(this,(function(t){switch(t.label){case 0:return e=i,[4,null===(n=navigator.mediaDevices)||void 0===n?void 0:n.getUserMedia({audio:!0,video:{width:1280,height:720}})];case 1:return e.current=t.sent(),u(E,(function(){var e=f.current[E];e&&(e.volume=0,e.srcObject=i.current)})),[2]}}))}))}().then((function(){return a.s.emit(l.k.JOIN,{room:e})})).catch((function(e){return console.error("Error getting userMedia:",e)})),function(){i.current.getTracks().forEach((function(e){return e.stop()})),a.s.emit(l.k.LEAVE)}}),[e]),{clients:r,provideMediaRef:(0,s.useCallback)((function(e,n){f.current[e]=n}),[])}}((0,i.g)().id),t=n.clients,c=n.provideMediaRef,u=function(e){void 0===e&&(e=1);var n=Array.from({length:e}).reduce((function(e,n,t,r){return t%2==0&&e.push(r.slice(t,t+2)),e}),[]),t=n.length,r="".concat(100/t,"%");return n.map((function(e,n,t){return n===t.length-1&&1===e.length?[{width:"100%",height:r}]:e.map((function(){return{width:"50%",height:r}}))})).flat()}(t.length);return(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",height:"100vh"},children:t.map((function(e,n){return(0,r.jsx)("div",{style:u[n],id:e,children:(0,r.jsx)("video",{width:"100%",height:"100%",ref:function(n){c(e,n)},autoPlay:!0,playsInline:!0,muted:e===E})},e)}))})};const m=function(e){var n=e.className;return(0,r.jsx)("div",{className:u()(o.RoomPage,n),children:(0,r.jsx)(g,{})})}},439:e=>{"use strict";e.exports=JSON.parse('["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]')},56:e=>{"use strict";e.exports=[]}}]);